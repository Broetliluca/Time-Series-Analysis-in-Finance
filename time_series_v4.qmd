---
title: "Time Series Analysis in Finance"
subtitle: "Carbon Allowance Prices and ETF Returns: A Comparative Analysis of Sustainable and Carbon-Intensive Assets in the EU"
author:
  - name: "Luca Signorini"
  - name: "Mattia Bettoja"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
format:
  pdf:
    documentclass: scrartcl
    toc: true
    number-sections: true
    fontsize: 9pt
    geometry: margin=1in
    code-block-font-size: tiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE
)

# Data Load & Reprocessing
library(tidyverse)
library(readr)
library(lubridate)
library(zoo)
library(tseries)
library(vars)
library(rugarch)
library(corrplot)
library(lmtest)


# EDA
library(dplyr)
library(tidyr)
library(ggplot2)
library(moments)

# Volatility Diagnostics
library(FinTS)
```

# Introduction

The project examines how changes in EU ETS carbon allowance prices are related to the financial behaviour of equity markets with different carbon exposures. Specifically, it compares a sustainable, Paris-Aligned equity ETF with a carbon-intensive Oil & Gas ETF to assess whether carbon pricing is reflected in asset returns, dynamic relationships, and risk dynamics. Utilising daily data, the analysis employs time-series methods to study return behaviour, lead–lag relationships, and volatility patterns across markets. The overarching aim is to evaluate whether carbon prices act as a driver of financial performance or risk, and whether sustainable assets exhibit greater resilience to carbon-related uncertainty than carbon-intensive investments.

# Background

## EU ETS Carbon Prices

The EU Emissions Trading System (EU ETS) is the European Union’s main policy instrument for reducing greenhouse gas emissions. It operates as a cap-and-trade system, where a fixed cap is set on the total amount of CO₂ that regulated entities are allowed to emit. Emission allowances (EUAs), each representing the right to emit one tonne of CO₂, are either allocated or auctioned to firms, which must surrender a corresponding number of allowances for their verified emissions.

EU ETS prices emerge from trading these allowances on the market and reflect expectations about future emissions constraints, regulatory stringency, and economic activity. When climate policy tightens or industrial demand for emissions rises, allowance prices tend to increase; when economic activity weakens or policy uncertainty rises, prices may fall.

Because carbon costs directly affect production expenses for emission-intensive industries, EU ETS prices are expected to influence corporate profitability, investment decisions, and risk perceptions—especially in sectors such as energy, utilities, and heavy industry. More broadly, carbon prices can affect financial markets by altering expected cash flows, increasing regulatory risk, and shifting capital toward lower-carbon business models, making them a potentially important factor for asset returns and volatility.

[Source](https://www.blackrock.com/uk/individual/products/318925/ishares-msci-europe-paris-aligned-climate-ucits-etf){target="\_blank"} (https://icapcarbonaction.com/en/ets-prices)

## Paris-Aligned Climate ETF

The iShares MSCI Europe Paris-Aligned Climate UCITS ETF tracks European companies whose business models are aligned with the Paris Agreement’s climate transition objectives. The index applies strict decarbonization criteria, including reduced exposure to high-emission activities, forward-looking emissions reduction targets, and increased weighting toward firms with stronger climate performance.

This ETF is well suited for the analysis because it represents a broad, diversified European equity portfolio that explicitly incorporates climate considerations while remaining exposed to overall market dynamics. As an EU-domiciled, Paris-aligned fund, it provides a natural benchmark for sustainable equity exposure within the same regulatory and economic environment as the EU ETS, making it an appropriate counterpart to carbon-intensive assets when assessing the financial relevance of carbon pricing.

[Source](https://www.blackrock.com/uk/individual/products/318925/ishares-msci-europe-paris-aligned-climate-ucits-etf){target="\_blank"} (https://www.blackrock.com/uk/individual/products/318925/ishares-msci-europe-paris-aligned-climate-ucits-etf)

## Oil & Gas ETF

The iShares STOXX Europe 600 Oil & Gas UCITS ETF tracks European companies operating in the oil and gas sector, including firms involved in exploration, production, refining, and distribution of fossil fuels. These companies are inherently carbon-intensive and are therefore directly exposed to carbon pricing, regulatory tightening, and transition risks arising from climate policy.

This ETF is used in the analysis as a representative proxy for carbon-intensive equity exposure within the European market. Its strong linkage to fossil fuel activities makes it particularly relevant for assessing whether and how changes in EU ETS carbon allowance prices affect the financial performance and risk dynamics of firms with high emissions intensity, in contrast to climate-aligned investment strategies.

[Source](https://www.ishares.com/ch/privatkunden/de/produkte/251954/ishares-stoxx-europe-600-oil-gas-ucits-etf-de-fund#/){target="\_blank"} (https://www.ishares.com/ch/privatkunden/de/produkte/251954/ishares-stoxx-europe-600-oil-gas-ucits-etf-de-fund#/)

# Related Literature
Aslan (2022) examines the interaction between EU ETS carbon allowance futures and European stock market sectors, focusing on volatility spillovers and market connectedness. The study finds that shocks in carbon markets can transmit to equity sectors, particularly during periods of heightened uncertainty such as energy market disruptions. Importantly, the results suggest that carbon prices affect financial markets mainly through volatility dynamics rather than through systematic effects on returns.

This literature provides a useful reference point for our analysis. While Aslan (2022) studies sector-level stock indices, our project takes a simpler and more exploratory approach by examining two broad European ETFs. Building on this idea, we aim to assess whether similar relationships between carbon prices and financial market volatility can be observed in these ETFs using Granger causality and GARCH-based models.

*Aydin Aslan, Peter N. Posch, Does carbon price volatility affect European stock market sectors? A connectedness network analysis, Finance Research Letters, Volume 50, 2022, 103318, ISSN 1544-6123, https://doi.org/10.1016/j.frl.2022.103318. (https://www.sciencedirect.com/science/article/pii/S1544612322004974)*

# Method Overview

The empirical analysis follows a structured time series methodology. First, the relevant datasets are imported, cleaned, and merged to ensure a consistent and comparable time span across all series. Log-returns are then computed to obtain stationary series suitable for econometric modeling.

Subsequently, exploratory data analysis is conducted to assess basic distributional properties and preliminary patterns. Time series diagnostics are applied to verify stationarity and model suitability. Dynamic relationships between carbon prices and ETF returns are examined using Granger causality tests within a VAR framework. Finally, volatility dynamics are analyzed through ARCH, GARCH, and GARCH-X models to investigate whether carbon price movements affect not only returns but also the risk structure of the assets.

# Data Loading & Preprocessing

## Load datasets from GitHub

```{r, load, echo=TRUE}
base <- "https://raw.githubusercontent.com/Broetliluca/Time-Series-Analysis-in-Finance/main/.csv%20Data/"

url_eua <- paste0(base, "icap-graph-price-data-2019-01-07-2025-11-20.csv")
url_pa  <- paste0(base, "iShares-MSCI-Europe-Paris-Aligned-Climate-UCITS-ETF-EUR-Acc_fund.csv")
url_oil <- paste0(base, "STOXX-Europe-600-Oil--Gas-UCITS-ETF-DE_fund.csv")

eua_raw  <- read_csv(url_eua, show_col_types = FALSE)
pa_raw   <- read_csv(url_pa,  show_col_types = FALSE)
oil_raw  <- read_csv(url_oil, show_col_types = FALSE)
```

## Cleaning Data

Several preprocessing steps were necessary to harmonize the datasets prior to analysis. Each dataset was first cleaned and transformed into a consistent structure. Subsequently, the series were merged over their common time span to ensure that observations for carbon prices, the Paris-Aligned ETF, and the Oil & Gas ETF are available for every time step. This procedure avoids inconsistencies arising from missing data and ensures comparability across series. The use code of the cleaning process is provided in the Appendix.

```{r, clean_eua, include=FALSE}
# Ensure tibble format
eua_raw <- as_tibble(eua_raw)

# Remove first descriptive row safely
eua_tmp <- eua_raw %>% slice(-1)

# Clean EUA data
eua_clean <- eua_tmp %>%
  rename(
    Date_raw  = `...1`,
    Primary   = `...5`,
    Secondary = `...6`
  ) %>%
  mutate(
    Date      = as.Date(Date_raw),
    Primary   = suppressWarnings(parse_number(Primary)),
    Secondary = suppressWarnings(parse_number(Secondary)),
    EUA_Price = if_else(!is.na(Primary), Primary, Secondary)
  ) %>%
  dplyr::select(Date, EUA_Price) %>%
  arrange(Date)

knitr::kable(
  head(eua_clean, 6),
  caption = "Cleaned EU ETS Carbon Price Data (First 6 Observations)",
  booktabs = TRUE
)

```

```{r, clean_pa, echo=FALSE, include=FALSE}
# Ensure PA data is a tibble
pa_raw <- as_tibble(pa_raw)

# Split the single-column format
pa_tmp <- pa_raw %>%
  separate(
    col = 1,
    into = c("Date_raw","Currency","NAV","Shares","Assets","FundRet","BenchRet"),
    sep = ";",
    fill = "right",
    extra = "merge"
  )

# Clean
pa_clean <- pa_tmp %>%
  mutate(
    Date_raw = str_replace(Date_raw, "\\.", "/"),
    Date     = suppressWarnings(dmy(Date_raw)),
    NAV      = suppressWarnings(parse_number(NAV))
  ) %>%
  dplyr::select(Date, PA_NAV = NAV) %>%
  filter(!is.na(Date)) %>%
  arrange(Date)

knitr::kable(
  head(pa_clean, 6),
  caption = "Cleaned Paris-Aligned ETF Data (First 6 Observations)",
  booktabs = TRUE
)
```

```{r, clean_oil, include=FALSE}
# Ensure tibble
oil_raw <- as_tibble(oil_raw)

# Split single-column format
oil_tmp <- oil_raw %>%
  tidyr::separate(
    col  = 1,
    into = c("Date_raw","Currency","NAV","Shares","Assets","FundRet","BenchRet"),
    sep  = ";",
    fill = "right",
    extra = "merge"
  )

# Clean OIL ETF data
oil_clean_full <- oil_tmp %>%
  dplyr::mutate(
    # Trim whitespace
    Date_raw = stringr::str_trim(Date_raw),

    # Fix missing dot before the year (Juli2025 → Juli.2025)
    Date_raw = stringr::str_replace(Date_raw,
                                    "([A-Za-zäöüÄÖÜ]+)([0-9]{4})", 
                                    "\\1.\\2"),

    # Replace all dots with slashes (31.Juli.2025 → 31/Juli/2025)
    Date_str = stringr::str_replace_all(Date_raw, "\\.", "/"),

    # Parse with German locale because of month names like "Juli"
    Date     = suppressWarnings(lubridate::dmy(Date_str, locale = "de_DE")),

    # Parse NAV
    NAV_num  = suppressWarnings(readr::parse_number(NAV))
  ) %>%
  dplyr::filter(!is.na(Date)) %>%  # <-- REQUIRED: remove invalid parsed rows
  dplyr::arrange(Date)


# Keep only Date + NAV
oil_clean <- oil_clean_full[, c("Date", "NAV_num")]
names(oil_clean)[2] <- "OIL_NAV"

# Check Parseing
sum(is.na(oil_clean$Date))

knitr::kable(
  head(oil_clean, 6),
  caption = "Cleaned Oil & Gas ETF Data (First 6 Observations)",
  booktabs = TRUE
)
```

```{r, merge, include=FALSE}
start_date <- max(
  min(eua_clean$Date, na.rm = TRUE),
  min(pa_clean$Date,  na.rm = TRUE),
  min(oil_clean$Date, na.rm = TRUE)
)

end_date <- min(
  max(eua_clean$Date, na.rm = TRUE),
  max(pa_clean$Date,  na.rm = TRUE),
  max(oil_clean$Date, na.rm = TRUE)
)

# Filter each series to the common window
eua_f <- eua_clean %>% dplyr::filter(Date >= start_date, Date <= end_date)
pa_f  <- pa_clean  %>% dplyr::filter(Date >= start_date, Date <= end_date)
oil_f <- oil_clean %>% dplyr::filter(Date >= start_date, Date <= end_date)

# Merge step by step
merged <- eua_f %>%
  dplyr::inner_join(pa_f,  by = "Date") %>%
  dplyr::inner_join(oil_f, by = "Date") %>%
  dplyr::arrange(Date)

knitr::kable(
  head(merged, 6),
  caption = "Cleaned and merged data for each timestamp",
  booktabs = TRUE
)
```

## Compute log-returns

```{r, returns, echo=FALSE}
returns <- merged %>%
  dplyr::mutate(
    EUA_ret = log(EUA_Price / dplyr::lag(EUA_Price)),
    PA_ret  = log(PA_NAV    / dplyr::lag(PA_NAV)),
    OIL_ret = log(OIL_NAV   / dplyr::lag(OIL_NAV))
  ) %>%
  tidyr::drop_na()

knitr::kable(
  head(returns, 6),
  caption = "Price and return for the three datasets",
  booktabs = TRUE
)
```

# Exploratory Data Analysis (EDA)

## Summary statistics

```{r, stats, cache=TRUE, echo=FALSE}
# Calculate main Statistic measurements
stats_tbl <- returns %>%
  summarise(
    mean_EUA = mean(EUA_ret),
    sd_EUA   = sd(EUA_ret),
    skew_EUA = skewness(EUA_ret),
    kurt_EUA = kurtosis(EUA_ret),

    mean_PA = mean(PA_ret),
    sd_PA   = sd(PA_ret),
    skew_PA = skewness(PA_ret),
    kurt_PA = kurtosis(PA_ret),

    mean_OIL = mean(OIL_ret),
    sd_OIL   = sd(OIL_ret),
    skew_OIL = skewness(OIL_ret),
    kurt_OIL = kurtosis(OIL_ret)
  )

# Transpose the Table
stats_tbl_tidy <- stats_tbl %>%
  pivot_longer(cols = everything(),
               names_to = c("stat", "asset"),
               names_sep = "_") %>%
  pivot_wider(names_from = asset, values_from = value) %>%
  rename(
    Statistic = stat,
    EUA = EUA,
    PA = PA,
    OIL = OIL
  )

knitr::kable(
  stats_tbl_tidy,
  caption = "Statistical key numbers for the three timeseries",
  booktabs = TRUE
)
```
The high standard deviation and excess kurtosis of EUA returns reflect the policy-driven and expectation-sensitive structure of the EU carbon market. Both ETFs display lower volatility, but the Oil & Gas ETF exhibits higher tail risk than the Paris-Aligned ETF.

## Time series plot of returns

```{r, plot_returns, cache=TRUE, echo=FALSE}
# Price levels (merged only)
merged %>%
  dplyr::select(Date, EUA_Price, PA_NAV, OIL_NAV) %>%
  pivot_longer(-Date, names_to = "Series", values_to = "Value") %>%
  ggplot(aes(Date, Value, color = Series)) +
  geom_line() +
  labs(
    title = "Price Levels",
    y = "Price / NAV",
    x = "Date"
  ) +
  theme_minimal()

# Daily log returns (merged)
returns %>%
  dplyr::select(Date, EUA_ret, PA_ret, OIL_ret) %>%
  pivot_longer(-Date, names_to = "Series", values_to = "Return") %>%
  ggplot(aes(Date, Return, color = Series)) +
  geom_line(alpha = 0.7) +
  labs(
    title = "Daily Log Returns",
    x = "Date",
    y = "Log Return"
  ) +
  theme_minimal()

```
The three price series evolve very differently over time. EUA carbon prices are highly volatile, while both ETFs display smoother price dynamics, with the Paris-Aligned ETF being the most stable.

Daily returns of all three series fluctuate around zero with no visible long-term trend. EUA returns exhibit much larger spikes than ETF returns, indicating higher short-term risk.

## Rolling 30-day volatility

```{r, rolling, cache=TRUE, echo=FALSE}
# Compute daily log-returns
returns <- merged %>%
  dplyr::mutate(
    EUA_ret = log(EUA_Price / dplyr::lag(EUA_Price)),
    PA_ret  = log(PA_NAV    / dplyr::lag(PA_NAV)),
    OIL_ret = log(OIL_NAV   / dplyr::lag(OIL_NAV))
  ) %>%
  tidyr::drop_na()

# Compute 30-day rolling volatility
returns_rolling <- returns %>%
  dplyr::mutate(
    vol_EUA = zoo::rollapply(EUA_ret, width = 30, FUN = sd, fill = NA, align = "right"),
    vol_PA  = zoo::rollapply(PA_ret,  width = 30, FUN = sd, fill = NA, align = "right"),
    vol_OIL = zoo::rollapply(OIL_ret, width = 30, FUN = sd, fill = NA, align = "right")
  )

# Plot rolling volatility
returns_rolling %>%
  dplyr::select(Date, vol_EUA, vol_PA, vol_OIL) %>%
  tidyr::pivot_longer(-Date, names_to = "Series", values_to = "Volatility") %>%
  ggplot(aes(Date, Volatility, color = Series)) +
  geom_line() +
  labs(
    title = "Rolling 30-Day Volatility",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()

```
Rolling volatility measures short-term risk dynamics by smoothing daily returns over a fixed window (here: ~1 trading month).

EUA carbon prices exhibit the highest and most unstable volatility, while the Paris-Aligned ETF consistently shows the lowest volatility. The Oil & Gas ETF lies in between but displays longer periods of elevated risk.

## Correlation matrix

```{r corrmatrix, cache=TRUE, echo=FALSE}
corr_mat <- cor(returns[, c("EUA_ret","PA_ret","OIL_ret")])

corrplot::corrplot(corr_mat, method="color", addCoef.col="black")

```

The correlation matrix shows that daily EUA carbon price returns have almost no linear relationship with either the Paris-Aligned ETF or the Oil & Gas ETF (correlations ≈ 0.09). This suggests that short-term carbon price fluctuations do not immediately affect equity performance in either sector.

In contrast, the Paris-Aligned ETF and the Oil & Gas ETF exhibit a moderate correlation of 0.45, reflecting their shared exposure to broader equity market movements. These results imply that carbon prices operate somewhat independently from daily stock market dynamics and support the need for more advanced dynamic models such as VAR or Granger causality to detect potential lagged effects.

# Time Series Diagnostics

Before modeling anything, we verify whether the series can be used in VAR, Granger, and GARCH by checking for Stationarity.

```{r, time series diagnostic, cache=TRUE, echo=FALSE}

adf_EUA  <- adf.test(returns$EUA_ret)
adf_PA   <- adf.test(returns$PA_ret)
adf_OIL  <- adf.test(returns$OIL_ret)

adf_EUA
adf_PA
adf_OIL

```
The ADF test rejects the presence of a unit root for all return series, confirming stationarity and validating the application of VAR, Granger causality, and GARCH models.

# Relationship Tests

**Do changes in carbon prices cause changes in ETF returns?**
<br>
The central research question of this study is whether movements in EU ETS carbon allowance prices lead to systematic changes in the returns of sustainable and carbon-intensive ETFs. To examine this, we focus on dynamic lead–lag relationships rather than simple correlations.

Specifically, we apply Granger causality tests within a Vector Autoregression (VAR) framework. Granger causality does not imply true economic causation; instead, it tests whether past values of one variable contain statistically significant information for predicting another variable, beyond what is already contained in its own past.

In this context, we examine whether lagged carbon price returns help predict:

- returns of the Oil & Gas ETF, representing carbon-intensive assets, and
- returns of the Paris-Aligned ETF, representing sustainable assets.

If carbon pricing is an important driver of financial performance, we would expect EUA returns to Granger-cause ETF returns—particularly for the carbon-intensive Oil & Gas ETF, which is more directly exposed to regulatory and transition risk.

At the same time, we also test for instantaneous causality, which captures contemporaneous relationships between markets. A significant instantaneous effect would indicate that carbon and equity markets respond simultaneously to common shocks, rather than through delayed transmission.

By combining Granger causality tests with impulse response analysis, this section assesses whether carbon prices act as a leading indicator, a coincident indicator, or have no dynamic influence on ETF returns at the daily frequency.

## Granger Causality: EUA -> Oil & Gas ETF

Using daily data, we allow for up to ten lags (approximately two trading weeks) and select the optimal lag length via the Akaike Information Criterion.

```{r, ganger causality eua-oil&gas, cache=TRUE, echo=FALSE}

lag_oil <- VARselect(returns[, c("EUA_ret","OIL_ret")], lag.max = 10)$selection["AIC(n)"]

var_oil <- VAR(returns[, c("EUA_ret","OIL_ret")], p = lag_oil)

causality(var_oil, cause = "EUA_ret")

```
The Granger causality test finds no evidence of lagged causal effects from EUA carbon price returns to Oil & Gas ETF returns, while the significant instantaneous causality suggests that both markets respond contemporaneously to common external shocks rather than exhibiting a predictive lead–lag relationship.

## Granger Causality: EUA -> Paris Aligned ETF

```{r, ganger causality eua-parisaligned, cache=TRUE, echo=FALSE}

lag_pa <- VARselect(returns[, c("EUA_ret","PA_ret")], lag.max = 10)$selection["AIC(n)"]

var_pa <- VAR(returns[, c("EUA_ret","PA_ret")], p = lag_pa)

causality(var_pa, cause = "EUA_ret")

```
Neither ETF shows Granger causality from carbon prices, meaning carbon price changes do not lead ETF returns over time.

The Granger causality tests provide no statistical evidence of lagged causal effects from EUA carbon price returns to either the Oil & Gas ETF or the Paris-Aligned ETF. This indicates that changes in carbon prices do not systematically precede or predict ETF returns at the daily frequency.

However, both ETFs exhibit significant instantaneous causality with EUA returns, suggesting that carbon and equity markets tend to react contemporaneously to common information or shocks, such as macroeconomic news, energy market developments, or policy announcements. In this sense, carbon prices appear to function as a coincident indicator rather than a leading driver of equity returns.

To further examine the dynamic response of ETF returns to carbon price shocks and to assess whether any short-term effects emerge beyond the Granger framework, we next analyze impulse response functions derived from the estimated VAR models.

## Impuls Responses

```{r, impuls respons, cache=TRUE, echo=FALSE, fig.height=3.5}
# Impuls Response Plot: EUA -> Oil & Gas ETF
irf_oil <- irf(
  var_oil,
  impulse  = "EUA_ret",
  response = "OIL_ret",
  boot     = TRUE,
  n.ahead  = 10
)

plot(irf_oil)

# Impuls Response Plot: EUA -> Paris Aligned ETF
irf_pa <- irf(
  var_pa,
  impulse  = "EUA_ret",
  response = "PA_ret",
  boot     = TRUE,
  n.ahead  = 10
)

plot(irf_pa)

```
How to read this plot

- **x-axis:** days after a one-standard-deviation shock to EUA returns
- **solid line:** estimated response of OIL returns
- **dashed lines:** 95% confidence bands

The impulse response functions show that shocks to EUA carbon price returns do not generate statistically significant or persistent responses in either the Oil & Gas ETF or the Paris-Aligned ETF. Any short-run movements remain within the confidence bands and quickly revert to zero. This visual evidence supports the Granger causality results and indicates that carbon price shocks do not dynamically transmit into ETF returns over time, reinforcing the interpretation that observed relationships are primarily contemporaneous rather than predictive.


# Volatility Diagnostics

Although the Granger causality and impulse response results show that changes in carbon prices do not predict ETF returns over time, this does not mean that carbon prices have no impact at all. Financial markets often react to regulatory and policy uncertainty not through immediate changes in returns, but through changes in risk and uncertainty.

In other words, carbon price movements may increase or decrease how volatile ETF returns are, even if they do not systematically raise or lower returns themselves. GARCH models are therefore used to examine whether carbon price dynamics are linked to persistent changes in volatility across assets. This helps distinguish between effects on expected returns and effects on risk.

## ARCH Test (Volatility Clustering)

```{r, ARCH Test, cache=TRUE, echo=FALSE}

ArchTest(returns$EUA_ret)
ArchTest(returns$PA_ret)
ArchTest(returns$OIL_ret)

```
The ARCH LM test strongly rejects homoskedasticity for all return series, confirming volatility clustering and justifying the use of GARCH models.

## GARCH(1,1) Estimation

Before explicitly testing whether carbon prices affect ETF volatility, we first estimate standard GARCH(1,1) models for each return series to characterize their intrinsic volatility dynamics. The aim of this step is not to explain volatility through external drivers, but to assess whether returns exhibit volatility clustering and persistence, which are common features of financial time series.

By estimating the GARCH parameters, we examine:

- how strongly volatility reacts to new shocks (alpha),
- how persistent volatility is over time (beta), and
- whether periods of elevated risk tend to decay quickly or remain prolonged (alpha + beta).

This baseline analysis provides a benchmark for comparing risk dynamics across carbon prices, sustainable assets, and carbon-intensive assets, and it establishes whether more advanced volatility models—such as GARCH-X specifications including carbon prices—are empirically justified.

```{r, GARCH Test, cache=TRUE, echo=FALSE}

# Specify GARCH(1,1) model
spec <- ugarchspec(
  variance.model = list(model = "sGARCH", garchOrder = c(1,1)),
  mean.model     = list(armaOrder = c(0,0), include.mean = TRUE),
  distribution.model = "norm"
)

# Fit models
garch_EUA  <- ugarchfit(spec, returns$EUA_ret)
garch_PA   <- ugarchfit(spec, returns$PA_ret)
garch_OIL  <- ugarchfit(spec, returns$OIL_ret)

# Extract key parameters
extract_garch <- function(fit, asset) {
  coefs <- coef(fit)
  tibble(
    Asset       = asset,
    Alpha       = coefs["alpha1"],
    Beta        = coefs["beta1"],
    Persistence = coefs["alpha1"] + coefs["beta1"]
  )
}

garch_table <- bind_rows(
  extract_garch(garch_EUA, "EUA Carbon Price"),
  extract_garch(garch_PA,  "Paris-Aligned ETF"),
  extract_garch(garch_OIL, "Oil & Gas ETF")
) %>%
  mutate(across(c(Alpha, Beta, Persistence), round, 3))

# Display results table
knitr::kable(
  garch_table,
  caption = "GARCH(1,1) Volatility Persistence Across Assets"
)

```

**EUA carbon prices** show strong volatility clustering with very high persistence (alpha + beta ≈ 0.97). Shocks lead to long-lasting increases in uncertainty, reflecting the policy-driven nature of the carbon market.

**The Paris-Aligned ETF** exhibits moderate volatility persistence (alpha + beta ≈ 0.89). While volatility responds to shocks, it decays relatively quickly, indicating lower exposure to prolonged uncertainty.

**The Oil & Gas ETF** displays extremely persistent volatility (alpha + beta ≈ 0.98). Although immediate reactions to shocks are weak, elevated volatility remains for extended periods, highlighting sustained risk in carbon-intensive assets. This can be seen also very clearly in the plots shown in the [appendix](sec:garch) - where the line goes slowly down after a sharp rising of volatility.

This indicates that carbon-intensive assets are highly sensitive to prolonged periods of uncertainty, even if short-term reactions are muted. This is consistent with exposure to regulatory risk, energy price uncertainty, and macroeconomic shocks.


```{r, GARCH volatility Plots, echo=FALSE,fig.show = "hide", results = "hide"}

vol_df <- tibble(
  Date = returns$Date,
  EUA  = sigma(garch_EUA),
  PA   = sigma(garch_PA),
  OIL  = sigma(garch_OIL)
)

y_lim <- c(0, 0.09)

# EUA volatility
ggplot(vol_df, aes(Date, EUA)) +
  geom_line(color = "steelblue") +
  scale_y_continuous(limits = y_lim) +
  labs(
    title = "Conditional Volatility – EUA Carbon Prices",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()

# Paris-Aligned ETF volatility
ggplot(vol_df, aes(Date, PA)) +
  geom_line(color = "steelblue") +
  scale_y_continuous(limits = y_lim) +
  labs(
    title = "Conditional Volatility – Paris-Aligned ETF",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()

# Oil & Gas ETF volatility
ggplot(vol_df, aes(Date, OIL)) +
  geom_line(color = "steelblue") +
  scale_y_continuous(limits = y_lim) +
  labs(
    title = "Conditional Volatility – Oil & Gas ETF",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()
```



## GARCH-X: Carbon Price Effects on ETF Volatility

We extend the GARCH(1,1) model by including EUA carbon price returns as an exogenous variable in the variance equation to test whether carbon prices directly affect ETF volatility.

```{r, GARCH-X EUA effect on ETF Volatility, cache=TRUE, echo=FALSE}
# GARCH-X: Carbon price effects on Oil & Gas ETF volatility

# Exogenous regressor: EUA carbon price returns
EUA_X <- matrix(returns$EUA_ret, ncol = 1)

# Specify GARCH-X model
spec_garchx <- ugarchspec(
  variance.model = list(
    model = "sGARCH",
    garchOrder = c(1,1),
    external.regressors = EUA_X
  ),
  mean.model = list(armaOrder = c(0,0), include.mean = TRUE),
  distribution.model = "norm"
)

# Fit GARCH-X model
garchx_OIL <- ugarchfit(
  spec = spec_garchx,
  data = returns$OIL_ret
)

# Extract coefficients and standard errors
coefs <- garchx_OIL@fit$matcoef

garchx_coef_table <- as_tibble(coefs, rownames = "Parameter") %>%
  mutate(
    Parameter = recode(
      Parameter,
      mu     = "Mean",
      omega  = "Constant",
      alpha1 = "ARCH effect",
      beta1  = "GARCH effect",
      vxreg1 = "Carbon price effect"
    )
  ) %>%
  mutate(across(where(is.numeric), round, 4))

knitr::kable(
  garchx_coef_table,
  caption = "GARCH-X Coefficient Estimates for Oil & Gas ETF Volatility"
)

```
While volatility persistence remains extremely high (GARCH effect), the coefficient on carbon price returns is not statistically significant. This indicates that daily carbon price movements do not directly drive ETF volatility once standard GARCH dynamics are accounted for. Elevated risk in carbon-intensive assets therefore reflects broader and more persistent sources of uncertainty rather than short-run carbon market shocks.

```{r, GARCH-X Test EUA effect on PA-ETF, cache=TRUE, echo=FALSE}
# GARCH-X: Carbon price effects on Paris-Aligned ETF volatility

# Exogenous regressor: EUA carbon price returns
EUA_X <- matrix(returns$EUA_ret, ncol = 1)

# Specify GARCH-X model
spec_garchx <- ugarchspec(
  variance.model = list(
    model = "sGARCH",
    garchOrder = c(1,1),
    external.regressors = EUA_X
  ),
  mean.model = list(armaOrder = c(0,0), include.mean = TRUE),
  distribution.model = "norm"
)

# Fit GARCH-X model
garchx_PA <- ugarchfit(
  spec = spec_garchx,
  data = returns$PA_ret
)

# Extract coefficient matrix
coefs_pa <- garchx_PA@fit$matcoef

# Build tidy results table
garchx_coef_table_pa <- as_tibble(coefs_pa, rownames = "Parameter") %>%
  mutate(
    Parameter = recode(
      Parameter,
      mu     = "Mean",
      omega  = "Constant",
      alpha1 = "ARCH effect",
      beta1  = "GARCH effect",
      vxreg1 = "Carbon price effect"
    )
  ) %>%
  mutate(across(where(is.numeric), round, 4))

# Display table
knitr::kable(
  garchx_coef_table_pa,
  caption = "GARCH-X Coefficient Estimates for Paris-Aligned ETF Volatility"
)

```

The estimated carbon price coefficient is close to zero and statistically clearly insignificant (p ≈ 0.97). This suggests that short-term fluctuations in EU ETS carbon prices do not exert a direct effect on the volatility of the Paris-Aligned ETF beyond the volatility persistence captured by the GARCH structure.

Overall, the volatility of sustainable assets appears largely insulated from carbon market fluctuations, supporting the view that Paris-Aligned ETFs are less exposed to carbon-related regulatory and transition risk than carbon-intensive assets.

# Conclusion
This study examined whether changes in EU ETS carbon allowance prices affect the returns and volatility of sustainable and carbon-intensive ETFs. Using daily data, we combined correlation analysis, Granger causality tests, impulse response functions, and GARCH-type volatility models to distinguish between effects on expected returns and effects on risk.

The results show no evidence of lagged causal effects from carbon price returns to ETF returns for either the Paris-Aligned ETF or the Oil & Gas ETF. Both ETFs exhibit significant instantaneous causality with EUA returns, indicating that carbon and equity markets respond contemporaneously to common shocks rather than through delayed transmission. Impulse response functions confirm that carbon price shocks do not generate persistent or statistically significant responses in ETF returns.

Volatility analysis reveals strong volatility clustering across all assets. Standard GARCH models show that the Oil & Gas ETF exhibits extremely high volatility persistence, while the Paris-Aligned ETF displays lower and more rapidly decaying risk. However, GARCH-X models including EUA returns as an exogenous variance driver find no statistically significant direct effect of carbon price movements on ETF volatility. Elevated risk in carbon-intensive assets therefore appears to reflect broader macroeconomic, regulatory, and energy-market uncertainty rather than short-run carbon price shocks.

Overall, the findings suggest that EU ETS carbon prices act primarily as a coincident indicator rather than a leading driver of ETF returns or volatility at the daily frequency. Sustainable assets appear relatively insulated from carbon market fluctuations, while carbon-intensive assets exhibit higher and more persistent risk, but not directly attributable to daily carbon price changes.

## Limitations and Further Research

Several limitations should be acknowledged. First, the analyzed ETFs are broad and diversified, meaning their returns and volatility are strongly influenced by general equity market movements. This may obscure more granular carbon price effects that could be detectable at the level of individual firms, sector-specific portfolios, or narrower industry ETFs.

Second, the analysis relies on daily data, which may be too high-frequency to capture the gradual transmission of regulatory and transition risk. Carbon pricing effects may materialize over longer horizons, suggesting that weekly or monthly data, or long-run cointegration frameworks, could provide additional insights.

Third, the GARCH-X specification includes only contemporaneous carbon price returns. Future research could explore lagged volatility spillovers, regime-switching volatility models, or multivariate GARCH frameworks to better capture cross-market risk transmission.

Extending the analysis to single stocks, carbon-intensive sub-industries, or event-based approaches around major EU ETS policy announcements may help identify more direct channels through which carbon pricing influences financial markets.

# Disclosure of GenAI use

Generative AI (OpenAI ChatGPT, GPT-5) was used to support the structuring, language refinement, and methodological clarification of this project. All outputs were critically reviewed and edited by the authors, who take full responsibility for the final content.

# Appendix

## Data Loading & Preprocessin

### Clean EUA carbon price data
```{r, clean_eua appendix}
# Ensure tibble format
eua_raw <- as_tibble(eua_raw)

# Remove first descriptive row safely
eua_tmp <- eua_raw %>% slice(-1)

# Clean EUA data
eua_clean <- eua_tmp %>%
  rename(
    Date_raw  = `...1`,
    Primary   = `...5`,
    Secondary = `...6`
  ) %>%
  mutate(
    Date      = as.Date(Date_raw),
    Primary   = suppressWarnings(parse_number(Primary)),
    Secondary = suppressWarnings(parse_number(Secondary)),
    EUA_Price = if_else(!is.na(Primary), Primary, Secondary)
  ) %>%
  dplyr::select(Date, EUA_Price) %>%
  arrange(Date)

knitr::kable(
  head(eua_clean, 6),
  caption = "Cleaned EU ETS Carbon Price Data (First 6 Observations)",
  booktabs = TRUE
)

```
### Clean Paris-Aligned ETF data

```{r, clean_pa appendix}
# Ensure PA data is a tibble
pa_raw <- as_tibble(pa_raw)

# Split the single-column format
pa_tmp <- pa_raw %>%
  separate(
    col = 1,
    into = c("Date_raw","Currency","NAV","Shares","Assets","FundRet","BenchRet"),
    sep = ";",
    fill = "right",
    extra = "merge"
  )

# Clean
pa_clean <- pa_tmp %>%
  mutate(
    Date_raw = str_replace(Date_raw, "\\.", "/"),
    Date     = suppressWarnings(dmy(Date_raw)),
    NAV      = suppressWarnings(parse_number(NAV))
  ) %>%
  dplyr::select(Date, PA_NAV = NAV) %>%
  filter(!is.na(Date)) %>%
  arrange(Date)

knitr::kable(
  head(pa_clean, 6),
  caption = "Cleaned Paris-Aligned ETF Data (First 6 Observations)",
  booktabs = TRUE
)
```
### Clean Oil & Gas ETF data

```{r, clean_oil appendix}
# Ensure tibble
oil_raw <- as_tibble(oil_raw)

# Split single-column format
oil_tmp <- oil_raw %>%
  tidyr::separate(
    col  = 1,
    into = c("Date_raw","Currency","NAV","Shares","Assets","FundRet","BenchRet"),
    sep  = ";",
    fill = "right",
    extra = "merge"
  )

# Clean OIL ETF data
oil_clean_full <- oil_tmp %>%
  dplyr::mutate(
    # Trim whitespace
    Date_raw = stringr::str_trim(Date_raw),

    # Fix missing dot before the year (Juli2025 → Juli.2025)
    Date_raw = stringr::str_replace(Date_raw,
                                    "([A-Za-zäöüÄÖÜ]+)([0-9]{4})", 
                                    "\\1.\\2"),

    # Replace all dots with slashes (31.Juli.2025 → 31/Juli/2025)
    Date_str = stringr::str_replace_all(Date_raw, "\\.", "/"),

    # Parse with German locale because of month names like "Juli"
    Date     = suppressWarnings(lubridate::dmy(Date_str, locale = "de_DE")),

    # Parse NAV
    NAV_num  = suppressWarnings(readr::parse_number(NAV))
  ) %>%
  dplyr::filter(!is.na(Date)) %>%  # <-- REQUIRED: remove invalid parsed rows
  dplyr::arrange(Date)


# Keep only Date + NAV
oil_clean <- oil_clean_full[, c("Date", "NAV_num")]
names(oil_clean)[2] <- "OIL_NAV"

# Check Parseing
sum(is.na(oil_clean$Date))

knitr::kable(
  head(oil_clean, 6),
  caption = "Cleaned Oil & Gas ETF Data (First 6 Observations)",
  booktabs = TRUE
)
```

### Align overlapping date range & merge datasets

```{r, merge appendix}
start_date <- max(
  min(eua_clean$Date, na.rm = TRUE),
  min(pa_clean$Date,  na.rm = TRUE),
  min(oil_clean$Date, na.rm = TRUE)
)

end_date <- min(
  max(eua_clean$Date, na.rm = TRUE),
  max(pa_clean$Date,  na.rm = TRUE),
  max(oil_clean$Date, na.rm = TRUE)
)

# Filter each series to the common window
eua_f <- eua_clean %>% dplyr::filter(Date >= start_date, Date <= end_date)
pa_f  <- pa_clean  %>% dplyr::filter(Date >= start_date, Date <= end_date)
oil_f <- oil_clean %>% dplyr::filter(Date >= start_date, Date <= end_date)

# Merge step by step
merged <- eua_f %>%
  dplyr::inner_join(pa_f,  by = "Date") %>%
  dplyr::inner_join(oil_f, by = "Date") %>%
  dplyr::arrange(Date)

knitr::kable(
  head(merged, 6),
  caption = "Cleaned and merged data for each timestamp",
  booktabs = TRUE
)
```
### Compute log-returns

```{r, returns appendix}
returns <- merged %>%
  dplyr::mutate(
    EUA_ret = log(EUA_Price / dplyr::lag(EUA_Price)),
    PA_ret  = log(PA_NAV    / dplyr::lag(PA_NAV)),
    OIL_ret = log(OIL_NAV   / dplyr::lag(OIL_NAV))
  ) %>%
  tidyr::drop_na()

head(returns)

knitr::kable(
  head(returns, 6),
  caption = "Price and return for the thre datasets",
  booktabs = TRUE
)
```
## Exploratory Data Analysis (EDA)

### Summary statistics

```{r, stats appendix, results='hide'}
# Calculate main Statistic measurements
stats_tbl <- returns %>%
  summarise(
    mean_EUA = mean(EUA_ret),
    sd_EUA   = sd(EUA_ret),
    skew_EUA = skewness(EUA_ret),
    kurt_EUA = kurtosis(EUA_ret),

    mean_PA = mean(PA_ret),
    sd_PA   = sd(PA_ret),
    skew_PA = skewness(PA_ret),
    kurt_PA = kurtosis(PA_ret),

    mean_OIL = mean(OIL_ret),
    sd_OIL   = sd(OIL_ret),
    skew_OIL = skewness(OIL_ret),
    kurt_OIL = kurtosis(OIL_ret)
  )

# Transpose the Table
stats_tbl_tidy <- stats_tbl %>%
  pivot_longer(cols = everything(),
               names_to = c("stat", "asset"),
               names_sep = "_") %>%
  pivot_wider(names_from = asset, values_from = value) %>%
  rename(
    Statistic = stat,
    EUA = EUA,
    PA = PA,
    OIL = OIL
  )
knitr::kable(
  stats_tbl_tidy,
  caption = "Statistical key numbers for the thre timeseries",
  booktabs = TRUE
)
```
### Time series plot of returns

```{r, plot_returns appendix, fig.show = "hide"}
# Price levels (merged only)
merged %>%
  dplyr::select(Date, EUA_Price, PA_NAV, OIL_NAV) %>%
  pivot_longer(-Date, names_to = "Series", values_to = "Value") %>%
  ggplot(aes(Date, Value, color = Series)) +
  geom_line() +
  labs(
    title = "Price Levels",
    y = "Price / NAV",
    x = "Date"
  ) +
  theme_minimal()

# Daily log returns (merged)
returns %>%
  dplyr::select(Date, EUA_ret, PA_ret, OIL_ret) %>%
  pivot_longer(-Date, names_to = "Series", values_to = "Return") %>%
  ggplot(aes(Date, Return, color = Series)) +
  geom_line(alpha = 0.7) +
  labs(
    title = "Daily Log Returns",
    x = "Date",
    y = "Log Return"
  ) +
  theme_minimal()

```
### Rolling 30-day volatility

```{r, rolling appendix, fig.show = "hide", results = "hide"}
# Compute daily log-returns
returns <- merged %>%
  dplyr::mutate(
    EUA_ret = log(EUA_Price / dplyr::lag(EUA_Price)),
    PA_ret  = log(PA_NAV    / dplyr::lag(PA_NAV)),
    OIL_ret = log(OIL_NAV   / dplyr::lag(OIL_NAV))
  ) %>%
  tidyr::drop_na()

# Compute 30-day rolling volatility
returns_rolling <- returns %>%
  dplyr::mutate(
    vol_EUA = zoo::rollapply(EUA_ret, width = 30, FUN = sd, fill = NA, align = "right"),
    vol_PA  = zoo::rollapply(PA_ret,  width = 30, FUN = sd, fill = NA, align = "right"),
    vol_OIL = zoo::rollapply(OIL_ret, width = 30, FUN = sd, fill = NA, align = "right")
  )

# Plot rolling volatility
returns_rolling %>%
  dplyr::select(Date, vol_EUA, vol_PA, vol_OIL) %>%
  tidyr::pivot_longer(-Date, names_to = "Series", values_to = "Volatility") %>%
  ggplot(aes(Date, Volatility, color = Series)) +
  geom_line() +
  labs(
    title = "Rolling 30-Day Volatility",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()

```
### Correlation matrix

```{r corrmatrix appendix, fig.show = "hide", results = "hide"}
corr_mat <- cor(returns[, c("EUA_ret","PA_ret","OIL_ret")])

corrplot::corrplot(corr_mat, method="color", addCoef.col="black")

```
## Time Series Diagnostics

Before modeling anything, we verify whether the series can be used in VAR, Granger, and GARCH by checking for Stationarity.

```{r, time series diagnostic appendix, fig.show = "hide", results = "hide"}

adf_EUA  <- adf.test(returns$EUA_ret)
adf_PA   <- adf.test(returns$PA_ret)
adf_OIL  <- adf.test(returns$OIL_ret)

adf_EUA
adf_PA
adf_OIL

```
### Granger Causality: EUA -> Oil & Gas ETF

```{r, ganger causality eua-oil&gas appendix, fig.show = "hide", results = "hide"}

lag_oil <- VARselect(returns[, c("EUA_ret","OIL_ret")], lag.max = 10)$selection["AIC(n)"]

var_oil <- VAR(returns[, c("EUA_ret","OIL_ret")], p = lag_oil)

causality(var_oil, cause = "EUA_ret")

```
### Granger Causality: EUA -> Paris Aligned ETF

```{r, ganger causality eua-parisaligned appendix, fig.show = "hide", results = "hide"}

lag_pa <- VARselect(returns[, c("EUA_ret","PA_ret")], lag.max = 10)$selection["AIC(n)"]

var_pa <- VAR(returns[, c("EUA_ret","PA_ret")], p = lag_pa)

causality(var_pa, cause = "EUA_ret")

```
### Impuls Responses

```{r, impuls respons appendix, fig.show = "hide", results = "hide"}
# Impuls Response Plot: EUA -> Oil & Gas ETF
irf_oil <- irf(
  var_oil,
  impulse  = "EUA_ret",
  response = "OIL_ret",
  boot     = TRUE,
  n.ahead  = 10
)

plot(irf_oil)

# Impuls Response Plot: EUA -> Paris Aligned ETF
irf_pa <- irf(
  var_pa,
  impulse  = "EUA_ret",
  response = "PA_ret",
  boot     = TRUE,
  n.ahead  = 10
)

plot(irf_pa)

```

## Volatility Diagnostics
### ARCH Test (Volatility Clustering)

```{r, ARCH Test appendix, fig.show = "hide", results = "hide"}

ArchTest(returns$EUA_ret)
ArchTest(returns$PA_ret)
ArchTest(returns$OIL_ret)

```

### GARCH(1,1) Estimation

```{r, GARCH Test appendix, fig.show = "hide", results = "hide"}

# Specify GARCH(1,1) model
spec <- ugarchspec(
  variance.model = list(model = "sGARCH", garchOrder = c(1,1)),
  mean.model     = list(armaOrder = c(0,0), include.mean = TRUE),
  distribution.model = "norm"
)

# Fit models
garch_EUA  <- ugarchfit(spec, returns$EUA_ret)
garch_PA   <- ugarchfit(spec, returns$PA_ret)
garch_OIL  <- ugarchfit(spec, returns$OIL_ret)

# Extract key parameters
extract_garch <- function(fit, asset) {
  coefs <- coef(fit)
  tibble(
    Asset       = asset,
    Alpha       = coefs["alpha1"],
    Beta        = coefs["beta1"],
    Persistence = coefs["alpha1"] + coefs["beta1"]
  )
}

garch_table <- bind_rows(
  extract_garch(garch_EUA, "EUA Carbon Price"),
  extract_garch(garch_PA,  "Paris-Aligned ETF"),
  extract_garch(garch_OIL, "Oil & Gas ETF")
) %>%
  mutate(across(c(Alpha, Beta, Persistence), round, 3))

# Display results table
knitr::kable(
  garch_table,
  caption = "GARCH(1,1) Volatility Persistence Across Assets"
)

```
### GARCH (1,1) plots {#sec:garch}

**How to read the plots:**

Y-axis: Volatility (σ)

This is the conditional volatility estimated by a GARCH(1,1) model.
It measures risk / uncertainty, not returns.

Example interpretation:
- σ = 0.02 → about 2% daily volatility
- σ = 0.01 → about 1% daily volatility
```{r, GARCH volatility Plots appendiy, cache=TRUE}

vol_df <- tibble(
  Date = returns$Date,
  EUA  = sigma(garch_EUA),
  PA   = sigma(garch_PA),
  OIL  = sigma(garch_OIL)
)

y_lim <- c(0, 0.09)

# EUA volatility
ggplot(vol_df, aes(Date, EUA)) +
  geom_line(color = "steelblue") +
  scale_y_continuous(limits = y_lim) +
  labs(
    title = "Conditional Volatility – EUA Carbon Prices",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()

# Paris-Aligned ETF volatility
ggplot(vol_df, aes(Date, PA)) +
  geom_line(color = "steelblue") +
  scale_y_continuous(limits = y_lim) +
  labs(
    title = "Conditional Volatility – Paris-Aligned ETF",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()

# Oil & Gas ETF volatility
ggplot(vol_df, aes(Date, OIL)) +
  geom_line(color = "steelblue") +
  scale_y_continuous(limits = y_lim) +
  labs(
    title = "Conditional Volatility – Oil & Gas ETF",
    y = "Volatility (σ)",
    x = "Date"
  ) +
  theme_minimal()
```

### GARCH-X: Carbon Price Effects on ETF Volatility (Oil & Gas ETF)

```{r, GARCH-X EUA effect on ETF Volatility appenidx, fig.show = "hide", results = "hide"}
# GARCH-X: Carbon price effects on Oil & Gas ETF volatility

# Exogenous regressor: EUA carbon price returns
EUA_X <- matrix(returns$EUA_ret, ncol = 1)

# Specify GARCH-X model
spec_garchx <- ugarchspec(
  variance.model = list(
    model = "sGARCH",
    garchOrder = c(1,1),
    external.regressors = EUA_X
  ),
  mean.model = list(armaOrder = c(0,0), include.mean = TRUE),
  distribution.model = "norm"
)

# Fit GARCH-X model
garchx_OIL <- ugarchfit(
  spec = spec_garchx,
  data = returns$OIL_ret
)

# Extract coefficients and standard errors
coefs <- garchx_OIL@fit$matcoef

garchx_coef_table <- as_tibble(coefs, rownames = "Parameter") %>%
  mutate(
    Parameter = recode(
      Parameter,
      mu     = "Mean",
      omega  = "Constant",
      alpha1 = "ARCH effect",
      beta1  = "GARCH effect",
      vxreg1 = "Carbon price effect"
    )
  ) %>%
  mutate(across(where(is.numeric), round, 4))

knitr::kable(
  garchx_coef_table,
  caption = "GARCH-X Coefficient Estimates for Oil & Gas ETF Volatility"
)

```

### GARCH-X: Carbon Price Effects on ETF Volatility (Paris Aligned ETF)

```{r, GARCH-X Test EUA effect on PA-ETF appendix, fig.show = "hide", results = "hide"}
# GARCH-X: Carbon price effects on Paris-Aligned ETF volatility

# Exogenous regressor: EUA carbon price returns
EUA_X <- matrix(returns$EUA_ret, ncol = 1)

# Specify GARCH-X model
spec_garchx <- ugarchspec(
  variance.model = list(
    model = "sGARCH",
    garchOrder = c(1,1),
    external.regressors = EUA_X
  ),
  mean.model = list(armaOrder = c(0,0), include.mean = TRUE),
  distribution.model = "norm"
)

# Fit GARCH-X model
garchx_PA <- ugarchfit(
  spec = spec_garchx,
  data = returns$PA_ret
)

# Extract coefficient matrix
coefs_pa <- garchx_PA@fit$matcoef

# Build tidy results table
garchx_coef_table_pa <- as_tibble(coefs_pa, rownames = "Parameter") %>%
  mutate(
    Parameter = recode(
      Parameter,
      mu     = "Mean",
      omega  = "Constant",
      alpha1 = "ARCH effect",
      beta1  = "GARCH effect",
      vxreg1 = "Carbon price effect"
    )
  ) %>%
  mutate(across(where(is.numeric), round, 4))

# Display table
knitr::kable(
  garchx_coef_table_pa,
  caption = "GARCH-X Coefficient Estimates for Paris-Aligned ETF Volatility"
)

```